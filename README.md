# J2735-ffm-java

This is a Java library and API for invoking J2735 (2024) encode/decode functions on C code generated by asn1c  
using the new Foreign Function and Memory API available in Java 22, and a Java wrapper generated
by the Jextract tool.

It enables converting between various ASN.1 encodings:
* XER - XML Encoding Rules
* JER - JSON Encoding Rules
* UPER - Unaligned Packed Encoding Rules

## Quickstart

Requires:

* Docker

Run docker-compose from the root directory:

```bash
docker compose up --build -d
```

Use the .http scripts in the `/j2735-2024-api/http-tests` directory to test the API.

## How it works

### Native library

An native, dynamic library, `libasnapplication.so`, was created from asn1c generated C code. 
The library is included in the `j2735-2024-ffm-lib/c-lib` directory.

See details about getting the ASN.1 files to compile here:
[Hacks needed to get asn1c to compile the J2735 (2024) ASN.1 files](j2735-2024-ffm-lib/hacks/README.md)

And details on creating the native library here: 
[J2735 (2024) Dynamic Library](j2735-2024-ffm-lib/c-lib/README.md)

The `Dockerfile` installs the native library in the `/usr/lib` directory of the runtime image, which makes it
generally available to applications running on that image.

### Java library

The Java library, j2735-2024-ffm-lib.jar, includes code generated by the Jextract tool, plus a `MessageFrameCodec`
class that exposes several easy-to-use functions for converting between XER, JER, and UPER.

Java FFM bindings were generated by running the `Jextract` tool on the `MessageFrame.h` header file on an Ubuntu VM with
the native library installed on it as follows:

[Download Jextract](https://jdk.java.net/jextract/)

`MessageFrame.h` is the top level header that contains all the others transitively.

Run `jextract` with a command line similar to:

```bash
./jextract \
    --include-dir ./headers \
    --output ./java-src \
    --target-package j2735_2024_MessageFrame \
    --library asnapplication \
    ./headers/MessageFrame.h 
```

where the `/headers` directory contains the generated C headers, and `asnapplication` is the platform-dependent name
of the native library (which on linux is the file name minus the `lib` prefix), and the `java-src` directory receives
the generated source.
















